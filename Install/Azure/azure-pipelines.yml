trigger: none
variables:
  major: 0
  minor: 0
  build: $(Build.BuildId)
  revision: $[counter(format('{0:yyyyMMdd}', pipeline.startTime), 0)]

stages:
- stage: Preparation
  pool:
    name: Backend-build
  jobs: 
  - job: Preparation
    steps:
    - powershell: |
        Write-Host "##vso[build.updatebuildnumber]$(major).$(minor).$(build).$(revision)"

- stage: Backend_build
  pool:
    name: Backend-build
  jobs:
  - job: build
    steps:
    - powershell: |
        write-host 'build 123'
      displayName: 'Run build'
  - job: 
    displayName: UI tests
    steps:
    - powershell: |
        write-host 'build 321'
      displayName: 'Run tests'

- stage: Dev
  dependsOn:
  - Backend_build
  jobs:
  - deployment:
    displayName: Dev deploy
    environment: Dev
    strategy:
     runOnce:
       deploy:
         steps:
           - script: echo '$(build.BuildNumber)'
             displayName: 'Dev based stage'
